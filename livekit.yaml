# LiveKit Server Configuration for TalkPlatform
# Tuned for low latency, high quality SFU architecture

port: 7880
bind_addresses:
  - ""

# HTTP API for room management and webhooks
api:
  port: 7881

# RTC configuration for media transport
rtc:
  # TCP fallback port for restrictive networks
  tcp_port: 7882
  
  # UDP port range for media streams (WebRTC)
  port_range_start: 50000
  port_range_end: 60000
  
  # External IP detection for proper ICE candidates
  use_external_ip: true
  
  # TURN server configuration for NAT traversal
  turn_servers:
    - host: coturn
      port: 3478
      protocol: udp
      username: livekit
      credential: turnpassword
    - host: coturn  
      port: 3478
      protocol: tcp
      username: livekit
      credential: turnpassword

# Redis configuration for scaling and state management
redis:
  address: redis:6379

# API keys for authentication
keys:
  devkey: devsecret

# Room configuration
room:
  # Codecs theo UC-05: Audio/Video quality adaptive
  enabled_codecs:
    # Audio: Opus (UC-05) - 6kbps to 510kbps adaptive
    - mime: audio/opus
      fmtp: "minptime=10;useinbandfec=1"
    
    # Video: VP8 (tương thích rộng) 
    - mime: video/VP8
    
    # Video: H.264 (hardware acceleration trên mobile)
    - mime: video/H264
      fmtp: "level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"
    
    # Video: VP9 (better compression)
    - mime: video/VP9
      
    # Video: AV1 (future-proof, bandwidth efficient)
    - mime: video/AV1

  # UC-04: Auto-create rooms for instant meetings
  auto_create: true
  
  # Maximum participants per room
  max_participants: 100
  
  # Room timeout settings
  empty_timeout: 300s      # 5 minutes after last participant leaves
  departure_timeout: 20s   # Grace period for reconnection

# Logging configuration
logging:
  level: info
  # Reduce log noise for production
  disable_pion_logs: true

# UC-06: Simulcast configuration for adaptive quality
simulcast:
  # Enable simulcast by default for better quality adaptation
  video:
    enabled: true
    # UC-05: Simulcast layers (High/Medium/Low)
    layers:
      - quality: high
        width: 1280
        height: 720
        bitrate: 2500000  # 2.5 Mbps
        fps: 30
      - quality: medium  
        width: 640
        height: 360
        bitrate: 800000   # 800 Kbps
        fps: 20
      - quality: low
        width: 320
        height: 180
        bitrate: 200000   # 200 Kbps  
        fps: 15

# Development settings
development:
  disable_strict_config: false